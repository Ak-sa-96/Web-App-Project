{% extends 'base.html' %}
{% block title %}Instructor Quiz Results{% endblock %}
{% block content %}

<div class="container my-5">
  <div class="card shadow-lg border-0 rounded-4">
    <div class="card-body p-4">

      <!-- üîπ Header Section -->
      <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
        <h2 class="fw-bold text-primary mb-2">
          <i class="bi bi-bar-chart-line"></i> Instructor Results
        </h2>
       <div class="d-flex gap-2 flex-wrap">
  <a href="{% url 'courses:instructor_results' %}" class="btn btn-outline-secondary btn-sm">
    <i class="bi bi-arrow-clockwise"></i> Reset
  </a>

  <!-- ‚úÖ New direct export buttons -->
  <a href="{% url 'courses:export_csv' %}" class="btn btn-success btn-sm">
    <i class="bi bi-filetype-csv"></i> Export CSV
  </a>

  <a href="{% url 'courses:export_excel' %}" class="btn btn-primary btn-sm">
    <i class="bi bi-file-earmark-excel"></i> Export Excel
  </a>
</div>

      </div>

      <!-- üí° Tip -->
      <p class="text-muted small mb-4">
        üí° Tip: Filter by Course or Quiz below, then click 
        <strong>‚ÄúExport CSV‚Äù</strong> or <strong>‚ÄúExport Excel‚Äù</strong> to download the filtered results.
      </p>

      <!-- üîç Filter Section -->
      <form method="get" class="row g-3 mb-4">
        <div class="col-md-5">
          <select name="course" class="form-select">
            <option value="">-- Filter by Course --</option>
            {% for course in courses %}
              <option value="{{ course.id }}" 
                      {% if selected_course == course.id|stringformat:"s" %}selected{% endif %}>
                {{ course.title }}
              </option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-5">
          <select name="quiz" class="form-select">
            <option value="">-- Filter by Quiz --</option>
            {% for quiz in quizzes %}
              <option value="{{ quiz.id }}" 
                      {% if selected_quiz == quiz.id|stringformat:"s" %}selected{% endif %}>
                {{ quiz.title }}
              </option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2 d-grid">
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-funnel"></i> Apply
          </button>
        </div>
      </form>

      <!-- üìä Results Table -->
      {% if results %}
        <div class="table-responsive">
          <table class="table table-hover table-bordered align-middle">
            <thead class="table-primary text-center">
              <tr>
                <th>#</th>
                <th>Student</th>
                <th>Quiz</th>
                <th>Course</th>
                <th>Score</th>
                <th>Total</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody>
              {% for r in results %}
              <tr>
                <td>{{ forloop.counter }}</td>
                <td class="fw-semibold">{{ r.user.username }}</td>
                <td>{{ r.quiz.title }}</td>
                <td>{{ r.quiz.course.title }}</td>
                <td class="text-success fw-bold">{{ r.score }}</td>
                <td>{{ r.total }}</td>
                <td>{{ r.taken_at|date:"M d, Y H:i" }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="alert alert-info text-center fs-5">
          <i class="bi bi-info-circle"></i> No quiz results found for the selected filters.
        </div>
      {% endif %}
    </div>
  </div>
</div>

{% endblock %}
